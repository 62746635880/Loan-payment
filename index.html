<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Devil Loan Payment Link Generator</title>
<script src="https://cdn.tailwindcss.com"></script>
<style>
  body { font-family: 'Poppins', sans-serif; }
  #qrPreview { max-width: 200px; margin-top: 10px; border-radius: 10px; }
  .hidden { display: none; }
</style>
</head>
<body class="bg-gradient-to-r from-indigo-100 to-purple-100 min-h-screen flex items-center justify-center p-4">

<div class="w-full max-w-xl bg-white shadow-2xl rounded-3xl p-8 border border-gray-200">

  <h1 class="text-4xl font-extrabold text-center text-white mb-8 
             bg-gradient-to-r from-indigo-600 via-purple-600 to-pink-500 
             p-6 rounded-3xl shadow-lg animate-pulse">
    Devil Loan Payment Link Generator
  </h1>

  <div class="mb-4">
    <label class="block font-semibold mb-2">App Name (Header)</label>
    <input id="appName" type="text" placeholder="My App" class="w-full px-5 py-3 rounded-xl border focus:ring-2 focus:ring-indigo-500"/>
  </div>

  <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
    <div>
      <label class="block font-semibold mb-2">Client Name</label>
      <input id="customerName" type="text" placeholder="John Doe" class="w-full px-4 py-3 rounded-xl border focus:ring-2 focus:ring-indigo-500"/>
    </div>
    <div>
      <label class="block font-semibold mb-2">Amount (INR)</label>
      <input id="amount" type="number" placeholder="1000" class="w-full px-4 py-3 rounded-xl border focus:ring-2 focus:ring-indigo-500"/>
    </div>
  </div>

  <div class="mb-4">
    <label class="block font-semibold mb-2">Standard UPI ID</label>
    <input id="upiId" type="text" placeholder="yourname@upi" class="w-full px-4 py-3 rounded-xl border focus:ring-2 focus:ring-indigo-500"/>
  </div>

  <div class="mb-6">
    <label class="block font-semibold mb-2">Upload QR Code (optional)</label>
    <input id="qrFile" type="file" accept="image/*" class="w-full px-4 py-2 rounded-xl border focus:ring-2 focus:ring-indigo-500"/>
    <img id="qrPreview" class="hidden" alt="QR Preview"/>
  </div>

  <button onclick="generateLink()" class="w-full bg-gradient-to-r from-indigo-600 to-purple-600 hover:from-indigo-700 hover:to-purple-700 text-white font-bold py-3 rounded-2xl shadow-lg transition mb-4">
    Generate Payment Link
  </button>

  <div id="output" class="hidden p-4 bg-indigo-50 rounded-xl border border-indigo-200 break-all">
    <p class="font-medium mb-2">Generated Link:</p>
    <a id="paymentLink" href="#" target="_blank" class="text-indigo-700 underline font-semibold break-words"></a>
  </div>
</div>

<script>
const qrInput = document.getElementById('qrFile');
const qrPreview = document.getElementById('qrPreview');

qrInput.addEventListener('change', () => {
  const file = qrInput.files[0];
  if(file){
    const reader = new FileReader();
    reader.onload = e => {
      qrPreview.src = e.target.result;
      qrPreview.classList.remove('hidden');
    };
    reader.readAsDataURL(file);
  } else {
    qrPreview.src = '';
    qrPreview.classList.add('hidden');
  }
});

function generateLink(){
  const app = document.getElementById('appName').value.trim() || "Payment";
  const name = document.getElementById('customerName').value.trim();
  const amount = document.getElementById('amount').value.trim();
  const upiId = document.getElementById('upiId').value.trim();

  if(!app || !name || !amount || !upiId){ alert("Fill all fields."); return; }

  const qrFile = qrInput.files[0];
  if(qrFile){
    const reader = new FileReader();
    reader.onload = e => { createLink(encodeURIComponent(e.target.result)); };
    reader.readAsDataURL(qrFile);
  } else { createLink(""); }

  function createLink(qrData){
    const expiry = Date.now() + 9*60*1000; // 9 min expiry
    const token = Math.random().toString(36).substring(2,10); // unique token
    const link = `pay.html?app=${encodeURIComponent(app)}&pn=${encodeURIComponent(name)}&am=${encodeURIComponent(amount)}&pa=${encodeURIComponent(upiId)}&qr=${qrData}&expiry=${expiry}&token=${token}`;
    document.getElementById('paymentLink').href = link;
    document.getElementById('paymentLink').innerText = link;
    document.getElementById('output').classList.remove('hidden');
  }
}
</script>
</body>
</html>

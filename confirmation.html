<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Payment Confirmation</title>
<script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gradient-to-r from-green-50 to-indigo-50 min-h-screen flex items-center justify-center p-4">

<div id="confirmationContainer" class="max-w-md w-full bg-white rounded-3xl shadow-2xl p-8 border border-gray-200 text-center">
  <h1 class="text-3xl font-bold text-green-600 mb-4">Payment Under Review</h1>
  <p id="confirmationMessage" class="text-gray-700 text-left mb-4"></p>
  <p id="timeLeft" class="text-red-600 font-semibold"></p>
</div>

<div id="expiredContainer" class="hidden w-full max-w-md bg-white rounded-3xl shadow-2xl p-8 border border-gray-200 text-center">
  <h1 class="text-3xl font-bold text-red-600 mb-4">Page Expired</h1>
  <p class="text-gray-700">The confirmation session has expired.</p>
</div>

<script>
const params = new URLSearchParams(window.location.search);
const app = params.get('app') || 'Payment';
const client = params.get('pn') || 'Customer';
const amount = params.get('am') || '0';
const expiryParam = params.get('expiry');
const expiryTime = expiryParam ? parseInt(expiryParam) : Date.now() + 9*60*1000;

document.getElementById('confirmationMessage').innerText = 
`Dear "${decodeURIComponent(client)}" Sir/Mam,\n\nYour â‚¹"${decodeURIComponent(amount)}" payment for "${decodeURIComponent(app)}" is under review.\nAfter confirmation, you will receive the NOC for loan closing.`;

const countdown = setInterval(()=>{
  const remaining = Math.floor((expiryTime - Date.now())/1000);
  if(remaining<=0){
    clearInterval(countdown);
    document.getElementById('confirmationContainer').classList.add('hidden');
    document.getElementById('expiredContainer').classList.remove('hidden');
  } else {
    const min = Math.floor(remaining/60);
    const sec = remaining%60;
    document.getElementById('timeLeft').textContent = `Time Left: ${min.toString().padStart(2,'0')}:${sec.toString().padStart(2,'0')}`;
  }
},1000);

// Prevent back to pay.html
if(localStorage.getItem('submitted') !== 'true'){
  window.location.href = 'https://loan-payment.vercel.app/';
}
</script>
</body>
</html>

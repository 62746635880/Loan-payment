<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Payment Confirmation</title>
<script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gradient-to-r from-green-50 to-indigo-50 min-h-screen flex items-center justify-center p-4">

<div id="confirmationContainer" class="max-w-md w-full bg-white rounded-3xl shadow-2xl p-8 border text-center">

  <h1 class="text-3xl font-bold text-green-600 mb-4">Payment Under Review</h1>
  <p id="message" class="text-gray-700 text-left text-lg mb-4"></p>

  <div class="text-gray-600 font-medium">Time Left: <span id="timer">09:00</span></div>
</div>

<div id="expiredContainer" class="hidden max-w-md w-full bg-white rounded-3xl shadow-2xl p-8 border text-center">
  <h1 class="text-3xl font-bold text-red-600 mb-4">Page Expired</h1>
  <p class="text-gray-700">Your confirmation session has timed out.</p>
</div>

<script>
const params = new URLSearchParams(window.location.search);
const client = params.get('pn') || localStorage.getItem('client') || 'Customer';
const amount = params.get('am') || localStorage.getItem('amount') || '0';
const app = params.get('app') || localStorage.getItem('app') || 'Payment';
const expiryParam = params.get('expiry') || Date.now()+9*60*1000;

document.getElementById('message').innerText=`Dear "${decodeURIComponent(client)}" Sir/Mam,\n\nYour â‚¹"${decodeURIComponent(amount)}" payment for "${decodeURIComponent(app)}" is under review.\nAfter confirmation, you will receive the NOC for loan closing.`;

const timerElement = document.getElementById('timer');
const expiryTime = parseInt(expiryParam);

const countdown = setInterval(()=>{
  const now = Date.now();
  let remaining = Math.floor((expiryTime-now)/1000);
  if(remaining<=0){
    clearInterval(countdown);
    document.getElementById('confirmationContainer').classList.add('hidden');
    document.getElementById('expiredContainer').classList.remove('hidden');
    return;
  }
  const minutes=Math.floor(remaining/60);
  const seconds=remaining%60;
  timerElement.textContent=`${minutes.toString().padStart(2,'0')}:${seconds.toString().padStart(2,'0')}`;
},1000);

// Prevent going back to pay page
history.pushState(null, null, location.href);
window.onpopstate = function(){ history.go(1); }
</script>
</body>
</html>
